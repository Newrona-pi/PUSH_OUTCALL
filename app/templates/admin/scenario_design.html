{% extends "admin/layout.html" %}

{% block title %}シナリオ設計 - Premium Auto-Call Admin{% endblock %}

{% block content %}
<section id="tab-scenarios" class="tab-content active">
    <div class="content panel" id="scenario-detail-panel">
        <div id="scenario-editor">
            <div class="header-actions">
                <h2 id="editor-title">SCENARIO EDITOR</h2>
                <div class="actions-right">
                    <button type="button" class="secondary small" onclick="copyCurrentScenario()">
                        <i class="fas fa-copy"></i>
                    </button>
                    <button type="button" class="danger small" onclick="deleteCurrentScenario()">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>

            <form id="scenario-form">
                <input type="hidden" id="scenario-id" value="{{ scenario_id or '' }}">

                <div class="form-row" style="display: flex; gap: 1rem; margin-bottom: 2rem;">
                    <div class="form-group" style="flex: 2;">
                        <label>シナリオ名称</label>
                        <input type="text" id="scenario-name" placeholder="例：2025年冬キャンペーン" required>
                    </div>
                    <div class="form-group" style="flex: 1;">
                        <label>AI対話モード</label>
                        <select id="scenario-mode">
                            <option value="A">A: 質問順守 (安定型)</option>
                            <option value="C">C: 臨機応変（応用型）</option>
                        </select>
                    </div>
                </div>

                <div class="panel"
                    style="background: rgba(255,255,255,0.02); margin-bottom: 2rem; border: 1px dashed var(--panel-border);">
                    <label style="margin-bottom: 1rem; display: block;">音声フロー設定</label>
                    <div class="form-group">
                        <label>開始時の挨拶 (Greeting)</label>
                        <textarea id="scenario-greeting" placeholder="お電話ありがとうございます。こちらは..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>録音告知・免責事項</label>
                        <textarea id="scenario-disclaimer" placeholder="この通話はサービス向上のため録音されます..."></textarea>
                    </div>
                </div>

                <div id="questions-area">
                    <label style="margin-bottom: 1rem; display: block;">STEP-BY-STEP QUESTIONS</label>
                    <div id="questions-container"></div>
                    <div class="add-question-box"
                        style="background: var(--glass); padding: 1rem; border-radius: 12px; margin-top: 1rem;">
                        <div style="display: flex; gap: 0.5rem;">
                            <textarea id="new-question-text" placeholder="次の質問を入力..."
                                style="min-height: 40px;"></textarea>
                            <button type="button" class="primary" onclick="addQuestionToList()"
                                style="padding: 0 1.5rem;">追加</button>
                        </div>
                    </div>
                </div>

                <div id="ending-area" style="margin-top: 2rem;">
                    <label style="margin-bottom: 1rem; display: block;">CALL TERMINATION GUIDANCE</label>
                    <div id="ending-container"></div>
                    <button type="button" class="secondary small" onclick="addEndingGuidance()">
                        <i class="fas fa-plus"></i> 終了メッセージ追加
                    </button>
                </div>

                <div class="panel"
                    style="background: rgba(255,255,255,0.02); margin-bottom: 2rem; border: 1px solid var(--panel-border);">
                    <label style="margin-bottom: 1rem; display: block;">システムパラメータ</label>
                    <div class="form-row"
                        style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 1.5rem;">
                        <div class="form-group" style="margin-bottom: 0;">
                            <label>稼働開始</label>
                            <input type="time" id="scenario-start-time" value="10:00">
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label>稼働終了</label>
                            <input type="time" id="scenario-end-time" value="18:00">
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label>無言警告 (秒)</label>
                            <input type="number" id="scenario-timeout-short" value="15">
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label>強制切断 (秒)</label>
                            <input type="number" id="scenario-timeout-long" value="60">
                        </div>
                    </div>
                    <div class="form-row"
                        style="display: flex; gap: 1rem; padding-top: 1.5rem; border-top: 1px solid var(--panel-border);">
                        <div class="form-group" style="flex: 1; margin-bottom: 0;">
                            <label>担当者転送先 (Bridge)</label>
                            <input type="text" id="scenario-bridge" placeholder="+8190...">
                        </div>
                        <div class="form-group" style="flex: 2; margin-bottom: 0;">
                            <label>SMSテンプレート</label>
                            <textarea id="scenario-sms" style="min-height: 40px;"
                                placeholder="資料はこちらから確認できます: https://..."></textarea>
                        </div>
                    </div>
                </div>

                <div class="actions-right" style="margin-top: 2rem;">
                    <button type="submit" class="primary" style="padding: 0.8rem 3rem;">保存内容を反映する</button>
                </div>
            </form>
        </div>
    </div>
</section>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const scenarioIdStr = "{{ scenario_id or '' }}";
        if (scenarioIdStr) {
            selectScenario(parseInt(scenarioIdStr));
        } else {
            showCreateScenarioForm();
        }
    });
</script>
{% endblock %}