<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Premium Auto-Call Admin</title>
    <link rel="stylesheet" href="/static/style.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&family=Noto+Sans+JP:wght@400;500;700&display=swap"
        rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>

<body>
    <header>
        <div class="logo-area">
            <h1><i class="fas fa-robot"></i> AUTO-CALL <span
                    style="font-weight: 300; font-size: 0.8em; opacity: 0.7;">Dynamic Series</span></h1>
        </div>
        <nav>
            <button class="tab-btn active" onclick="openTab('tab-scenarios')">
                <i class="fas fa-project-diagram"></i> シナリオ設計
            </button>
            <button class="tab-btn" onclick="openTab('tab-outbound')">
                <i class="fas fa-phone-alt"></i> 架電リスト
            </button>
            <button class="tab-btn" onclick="openTab('tab-logs')">
                <i class="fas fa-history"></i> 通話履歴・分析
            </button>
        </nav>
        <div class="status-indicator">
            <span class="badge completed" style="font-size: 0.7rem; letter-spacing: 0.05em;">SYSTEM ACTIVE</span>
        </div>
    </header>

    <main>
        <!-- Tab 1: Scenarios -->
        <section id="tab-scenarios" class="tab-content active">
            <div class="split-view">
                <!-- Left: List -->
                <div class="sidebar panel">
                    <h2>SCENARIOS</h2>
                    <button class="primary" style="width: 100%; margin-bottom: 1rem;"
                        onclick="showCreateScenarioForm()">
                        <i class="fas fa-plus"></i> 新規シナリオ作成
                    </button>
                    <ul id="scenario-list">
                        <!-- JS renders list here -->
                    </ul>
                </div>

                <!-- Right: Details -->
                <div class="content panel" id="scenario-detail-panel">
                    <div id="welcome-message" style="text-align: center; color: var(--text-muted); margin-top: 50px;">
                        <i class="fas fa-magic" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.2;"></i>
                        <p>左側のリストからシナリオを選択するか、<br>新しいシナリオを設計してください。</p>
                    </div>

                    <!-- Scenario Edit Form -->
                    <div id="scenario-editor" class="hidden">
                        <div class="header-actions">
                            <h2 id="editor-title">SCENARIO EDITOR</h2>
                            <div class="actions-right">
                                <button type="button" class="secondary small" onclick="copyCurrentScenario()">
                                    <i class="fas fa-copy"></i>
                                </button>
                                <button type="button" class="danger small" onclick="deleteCurrentScenario()">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>

                        <form id="scenario-form">
                            <input type="hidden" id="scenario-id">

                            <div class="form-row" style="display: flex; gap: 1rem; margin-bottom: 2rem;">
                                <div class="form-group" style="flex: 2;">
                                    <label>シナリオ名称</label>
                                    <input type="text" id="scenario-name" placeholder="例：2025年冬キャンペーン" required>
                                </div>
                                <div class="form-group" style="flex: 1;">
                                    <label>AI対話モード</label>
                                    <select id="scenario-mode">
                                        <option value="A">A: 質問順守 (安定型)</option>
                                        <option value="C">C: 臨機応変（応用型）</option>
                                    </select>
                                </div>
                            </div>

                            <div class="panel"
                                style="background: rgba(255,255,255,0.02); margin-bottom: 2rem; border: 1px dashed var(--panel-border);">
                                <label style="margin-bottom: 1rem; display: block;">音声フロー設定</label>
                                <div class="form-group">
                                    <label>開始時の挨拶 (Greeting)</label>
                                    <textarea id="scenario-greeting" placeholder="お電話ありがとうございます。こちらは..."></textarea>
                                </div>
                                <div class="form-group">
                                    <label>録音告知・免責事項</label>
                                    <textarea id="scenario-disclaimer" placeholder="この通話はサービス向上のため録音されます..."></textarea>
                                </div>
                            </div>

                            <div id="questions-area">
                                <label style="margin-bottom: 1rem; display: block;">STEP-BY-STEP QUESTIONS</label>
                                <div id="questions-container"></div>
                                <div class="add-question-box"
                                    style="background: var(--glass); padding: 1rem; border-radius: 12px; margin-top: 1rem;">
                                    <div style="display: flex; gap: 0.5rem;">
                                        <textarea id="new-question-text" placeholder="次の質問を入力..."
                                            style="min-height: 40px;"></textarea>
                                        <button type="button" class="primary" onclick="addQuestionToList()"
                                            style="padding: 0 1.5rem;">追加</button>
                                    </div>
                                </div>
                            </div>

                            <div id="ending-area" style="margin-top: 2rem;">
                                <label style="margin-bottom: 1rem; display: block;">CALL TERMINATION GUIDANCE</label>
                                <div id="ending-container"></div>
                                <button type="button" class="secondary small" onclick="addEndingGuidance()">
                                    <i class="fas fa-plus"></i> 終了メッセージ追加
                                </button>
                            </div>

                            <div class="panel"
                                style="background: rgba(255,255,255,0.02); margin-bottom: 2rem; border: 1px solid var(--panel-border);">
                                <label style="margin-bottom: 1rem; display: block;">システムパラメータ</label>
                                <div class="form-row"
                                    style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 1.5rem;">
                                    <div class="form-group" style="margin-bottom: 0;">
                                        <label>稼働開始</label>
                                        <input type="time" id="scenario-start-time" value="10:00">
                                    </div>
                                    <div class="form-group" style="margin-bottom: 0;">
                                        <label>稼働終了</label>
                                        <input type="time" id="scenario-end-time" value="18:00">
                                    </div>
                                    <div class="form-group" style="margin-bottom: 0;">
                                        <label>無言警告 (秒)</label>
                                        <input type="number" id="scenario-timeout-short" value="15">
                                    </div>
                                    <div class="form-group" style="margin-bottom: 0;">
                                        <label>強制切断 (秒)</label>
                                        <input type="number" id="scenario-timeout-long" value="60">
                                    </div>
                                </div>
                                <div class="form-row"
                                    style="display: flex; gap: 1rem; padding-top: 1.5rem; border-top: 1px solid var(--panel-border);">
                                    <div class="form-group" style="flex: 1; margin-bottom: 0;">
                                        <label>担当者転送先 (Bridge)</label>
                                        <input type="text" id="scenario-bridge" placeholder="+8190...">
                                    </div>
                                    <div class="form-group" style="flex: 2; margin-bottom: 0;">
                                        <label>SMSテンプレート</label>
                                        <textarea id="scenario-sms" style="min-height: 40px;"
                                            placeholder="資料はこちらから確認できます: https://..."></textarea>
                                    </div>
                                </div>
                            </div>

                            <div class="actions-right" style="margin-top: 2rem;">
                                <button type="submit" class="primary" style="padding: 0.8rem 3rem;">保存内容を反映する</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </section>

        <!-- Tab 2: Outbound -->
        <section id="tab-outbound" class="tab-content">
            <div class="panel">
                <h2>架電実行マネージャー</h2>
                <div class="actions-bar"
                    style="background: var(--glass); padding: 1.5rem; border-radius: 12px; border: 1px solid var(--panel-border);">
                    <div class="form-group" style="margin-bottom: 0; flex: 1;">
                        <label>適用シナリオ</label>
                        <select id="outbound-scenario-select">
                            <option value="">未選択</option>
                        </select>
                    </div>
                    <div style="display: flex; gap: 0.5rem; align-items: flex-end;">
                        <input type="file" id="target-csv" accept=".csv" style="display:none"
                            onchange="handleFileUpload(this)">
                        <button class="secondary" onclick="document.getElementById('target-csv').click()">
                            <i class="fas fa-file-csv"></i> CSVインポート
                        </button>
                        <button class="primary" onclick="startCalls()">
                            <i class="fas fa-play-circle"></i> 一斉架電開始
                        </button>
                        <button class="danger" onclick="stopAllCalls()" style="padding: 0.6rem 2rem;">
                            <i class="fas fa-stop-circle"></i> 強制停止
                        </button>
                    </div>
                </div>

                <div style="margin-top: 2rem;">
                    <table id="targets-table">
                        <thead>
                            <tr>
                                <th>対象電話番号</th>
                                <th>実行状態</th>
                                <th>インポート日時</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Tab 3: Logs -->
        <section id="tab-logs" class="tab-content">
            <div class="panel">
                <div class="header-actions">
                    <h2>通話履歴・分析</h2>
                    <div class="actions-right">
                        <button class="secondary small" onclick="exportZIP()"><i class="fas fa-download"></i>
                            ZIP一括出力</button>
                        <button class="secondary small" onclick="loadLogs()"><i class="fas fa-sync"></i> 更新</button>
                    </div>
                </div>

                <div class="filter-bar" style="margin-bottom: 1.5rem;">
                    <input type="text" id="filter-phone" placeholder="電話番号で履歴を絞り込む..." style="max-width: 300px;">
                </div>

                <table id="logs-table">
                    <thead>
                        <tr>
                            <th>発生日時</th>
                            <th>方向</th>
                            <th>相手先番号</th>
                            <th>通話状態</th>
                            <th>分類タグ</th>
                            <th>音声/記録</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </section>

        </section>
    </main>

    <script src="/static/script.js?v={{ now_timestamp }}"></script>

</body>

</html>