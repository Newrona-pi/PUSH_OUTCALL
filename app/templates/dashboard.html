<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Twilio シナリオ管理画面</title>
    <link rel="stylesheet" href="/static/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
</head>

<body>
    <header>
        <h1>Twilio シナリオ管理システム</h1>
        <nav>
            <button class="tab-btn active" onclick="openTab('tab-scenarios')">シナリオ設定</button>
            <button class="tab-btn" onclick="openTab('tab-numbers')">電話番号設定</button>
            <button class="tab-btn" onclick="openTab('tab-logs')">通話ログ・集計</button>
        </nav>
    </header>

    <main>
        <!-- Tab 1: Scenarios -->
        <section id="tab-scenarios" class="tab-content active">
            <div class="panel">
                <h2>シナリオの新規作成・編集</h2>
                <p class="description">※電話での応答内容（シナリオ）を作成する画面です。</p>
                <form id="scenario-form">
                    <div class="form-group">
                        <label>シナリオ名</label>
                        <input type="text" id="scenario-name" placeholder="例：キャンペーンA用、求人受付用" required>
                        <p class="help-text">※管理用の名前です。発信者には聞こえません。</p>
                    </div>

                    <div class="form-group">
                        <label>挨拶メッセージ</label>
                        <textarea id="scenario-greeting" placeholder="例：お電話ありがとうございます。株式会社〇〇です。"></textarea>
                        <p class="help-text">※電話が繋がった直後に流れる最初のメッセージを入力してください。</p>
                    </div>

                    <div class="form-group">
                        <label>録音の告知（免責事項）</label>
                        <textarea id="scenario-disclaimer" placeholder="例：品質向上のため、この通話は録音させていただきます。"></textarea>
                        <p class="help-text">※挨拶の後に流れる、録音告知などの補足メッセージを入力してください。</p>
                    </div>

                    <button type="submit">シナリオを保存する</button>
                </form>
            </div>

            <div class="panel">
                <h2>登録済みシナリオ一覧</h2>
                <p class="description">※作成済みのシナリオリストです。クリックすると右(下)で質問を追加できます。</p>
                <ul id="scenario-list"></ul>
            </div>

            <div id="questions-section" class="panel hidden">
                <h3>質問の管理：<span id="current-scenario-name"></span></h3>
                <p class="description">※選択中のシナリオで、どのような質問をするか設定します。</p>

                <form id="question-form">
                    <div class="form-group">
                        <label>質問内容</label>
                        <input type="text" id="question-text" placeholder="例：お名前をおっしゃってください。" required>
                        <p class="help-text">※ロボットが読み上げる質問文を入力してください。</p>
                    </div>

                    <div class="form-group">
                        <label>順番</label>
                        <input type="number" id="question-order" placeholder="例：1" value="0" style="width: 80px;">
                        <p class="help-text">※質問をする順番を数値で指定します（小さい順に質問されます）。</p>
                    </div>

                    <button type="submit">質問を追加する</button>
                </form>

                <h4>登録済みの質問リスト</h4>
                <ul id="question-list"></ul>
            </div>
        </section>

        <!-- Tab 2: Phone Numbers -->
        <section id="tab-numbers" class="tab-content">
            <div class="panel">
                <h2>電話番号とシナリオの紐付け</h2>
                <p class="description">※Twilioの電話番号に対して、どのシナリオを再生するかを設定します。</p>

                <form id="number-form">
                    <div class="form-group">
                        <label>電話番号</label>
                        <input type="text" id="phone-number" placeholder="例：+819012345678" required>
                        <p class="help-text">※Twilioで購入した電話番号を「+81」から始まる形式で入力してください。</p>
                    </div>

                    <div class="form-group">
                        <label>適用するシナリオ</label>
                        <select id="number-scenario-select" required>
                            <option value="">シナリオを選択してください</option>
                        </select>
                        <p class="help-text">※この電話番号にかかってきた時に流すシナリオを選択してください。</p>
                    </div>

                    <div class="form-group">
                        <label>ラベル（メモ）</label>
                        <input type="text" id="phone-label" placeholder="例：東京本社 代表電話">
                        <p class="help-text">※管理用のメモです（省略可能）。どの番号か分かりやすくするための名前です。</p>
                    </div>

                    <button type="submit">設定を保存する</button>
                </form>
            </div>

            <div class="panel">
                <h2>現在の設定一覧</h2>
                <p class="description">※現在稼働中の電話番号設定リストです。</p>
                <table id="number-table">
                    <thead>
                        <tr>
                            <th>電話番号</th>
                            <th>シナリオID</th>
                            <th>ラベル</th>
                            <th>状態</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </section>

        <!-- Tab 3: Logs -->
        <section id="tab-logs" class="tab-content">
            <div class="panel controls">
                <h2>通話ログ検索・出力</h2>
                <p class="description">※過去の通話履歴や回答内容を確認・ダウンロードできる画面です。</p>

                <div class="search-box">
                    <div class="form-group">
                        <label>着信番号 (To) で絞り込み</label>
                        <input type="text" id="filter-to" placeholder="例：+819012345678">
                        <p class="help-text">※特定のTwilio番号への着信だけを見たい場合に入力してください。</p>
                    </div>

                    <div class="form-group">
                        <label>発信者番号 (From) で絞り込み</label>
                        <input type="text" id="filter-from" placeholder="例：+8180...">
                        <p class="help-text">※特定の人からの電話だけを見たい場合に入力してください。</p>
                    </div>

                    <div class="actions">
                        <button onclick="loadLogs()">検索して表示</button>
                        <button onclick="exportCSV()" class="secondary">CSVダウンロード</button>
                    </div>
                    <p class="help-text" style="margin-top:0.5rem;">※CSVダウンロードは、現在の絞り込み条件（着信番号）に基づいて出力されます。</p>
                </div>
            </div>

            <div class="panel">
                <h2>履歴一覧</h2>
                <table id="logs-table">
                    <thead>
                        <tr>
                            <th style="width:150px;">日時</th>
                            <th style="width:120px;">発信者 (From)</th>
                            <th style="width:120px;">着信先 (To)</th>
                            <th style="width:80px;">状態</th>
                            <th>回答内容 (質問と録音)</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </section>
    </main>

    <script src="/static/script.js"></script>
</body>

</html>